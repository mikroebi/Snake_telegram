<!DOCTYPE html><html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Snake Game</title>
  <style>
    :root {
      --bg: #0f172a;
      --canvas: #020617;
      --snake: #22c55e;
      --apple: #ef4444;
      --text: #e5e7eb;
    }
    body.light {
      --bg: #f8fafc;
      --canvas: #e5e7eb;
      --snake: #16a34a;
      --apple: #dc2626;
      --text: #020617;
    }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: system-ui, sans-serif;
    }
    .game { text-align: center; }
    canvas {
      background: var(--canvas);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,.4);
      touch-action: none;
    }
    .top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    button {
      background: none;
      border: 1px solid var(--text);
      color: var(--text);
      padding: 4px 10px;
      border-radius: 8px;
    }
    .score { margin-top: 8px; font-size: 18px; }
  </style>
</head>
<body>
  <div class="game">
    <div class="top">
      <button id="theme">ðŸŒ— Theme</button>
      <button id="sound">ðŸ”Š Sound</button>
    </div>
    <canvas id="game" width="320" height="320"></canvas>
    <div class="score">Score: <span id="score">0</span></div>
  </div><script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const eatSound = new Audio('https://actions.google.com/sounds/v1/cartoon/pop.ogg');

const grid = 16;
let count = 0;
let score = 0;
let soundOn = true;

let snake = { x:160, y:160, dx:grid, dy:0, cells:[], maxCells:4 };
let apple = { x:160, y:160 };

function rand(min,max){return Math.floor(Math.random()*(max-min))+min;}

function loop(){
  requestAnimationFrame(loop);
  if(++count<4) return; count=0;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  snake.x+=snake.dx; snake.y+=snake.dy;
  if(snake.x<0) snake.x=canvas.width-grid;
  if(snake.x>=canvas.width) snake.x=0;
  if(snake.y<0) snake.y=canvas.height-grid;
  if(snake.y>=canvas.height) snake.y=0;

  snake.cells.unshift({x:snake.x,y:snake.y});
  if(snake.cells.length>snake.maxCells) snake.cells.pop();

  ctx.fillStyle=getComputedStyle(document.body).getPropertyValue('--apple');
  ctx.fillRect(apple.x,apple.y,grid-1,grid-1);

  ctx.fillStyle=getComputedStyle(document.body).getPropertyValue('--snake');
  snake.cells.forEach((c,i)=>{
    ctx.fillRect(c.x,c.y,grid-1,grid-1);
    if(c.x===apple.x && c.y===apple.y){
      snake.maxCells++; score++; scoreEl.innerText=score;
      if(soundOn) eatSound.play();
      apple.x=rand(0,20)*grid; apple.y=rand(0,20)*grid;
    }
    for(let j=i+1;j<snake.cells.length;j++){
      if(c.x===snake.cells[j].x && c.y===snake.cells[j].y){ reset(); }
    }
  });
}

function reset(){
  snake={x:160,y:160,dx:grid,dy:0,cells:[],maxCells:4};
  score=0; scoreEl.innerText=0;
}

const scoreEl=document.getElementById('score');

// keyboard
addEventListener('keydown',e=>{
  if(e.key==='ArrowLeft'&&snake.dx===0){snake.dx=-grid;snake.dy=0}
  if(e.key==='ArrowUp'&&snake.dy===0){snake.dy=-grid;snake.dx=0}
  if(e.key==='ArrowRight'&&snake.dx===0){snake.dx=grid;snake.dy=0}
  if(e.key==='ArrowDown'&&snake.dy===0){snake.dy=grid;snake.dx=0}
});

// touch (swipe)
let sx=0,sy=0;
canvas.addEventListener('touchstart',e=>{
  sx=e.touches[0].clientX; sy=e.touches[0].clientY;
});
canvas.addEventListener('touchend',e=>{
  let dx=e.changedTouches[0].clientX-sx;
  let dy=e.changedTouches[0].clientY-sy;
  if(Math.abs(dx)>Math.abs(dy)){
    if(dx>0 && snake.dx===0){snake.dx=grid;snake.dy=0}
    if(dx<0 && snake.dx===0){snake.dx=-grid;snake.dy=0}
  } else {
    if(dy>0 && snake.dy===0){snake.dy=grid;snake.dx=0}
    if(dy<0 && snake.dy===0){snake.dy=-grid;snake.dx=0}
  }
});

// ui
theme.onclick=()=>document.body.classList.toggle('light');
sound.onclick=()=>{soundOn=!soundOn; sound.innerText=soundOn?'ðŸ”Š Sound':'ðŸ”‡ Sound'};

requestAnimationFrame(loop);
</script></body>
                                </html>
